```{r import main data set}
library(caret)
library(nnet)
library(gmodels)
library(NeuralNetTools)

nn_set = read.csv("../data/GermanCredit.csv", sep = ";", header = TRUE)


nn_set["RESPONSE"][nn_set["RESPONSE"] == 0] = "Bad Rating"
nn_set["RESPONSE"][nn_set["RESPONSE"] == 1] = "Good Rating"

#convert all concerned variables to factors
cols = c(2,4:10,12:22,24:32)
nn_set[,cols]= lapply(nn_set[,cols], as.factor)

#Remove col"OBS."
nn_set = nn_set[,-1]

summary(nn_set)

#With the help of the summary function we are able to identify some incorrect values such as edutcation = -1, age = 125 and guarantor = 2 (only one occurrence of 2, might be a typo) 

#Change the incorrect values, to be noted in the final report !!!

nn_set[37,8]=1
nn_set[234,18]=1
nn_set[537,22]=75
```


```{r data splitting}
set.seed(3456)
trainIndex <- createDataPartition(nn_set$RESPONSE, p = .7,
                                  list = FALSE)

nnet_train <- nn_set[trainIndex,]

nnet_test <- nn_set[-trainIndex,]
```


```{r nnet fit and prediction}
nnetFit <- caret::train(RESPONSE ~ ., data = nnet_train, method = "nnet",
    trace = FALSE, trControl = trainControl(method = "cv", sampling = "down"))

nnetFit
#TestClasses <- iris[-val_index, 5]

nnet_pred = predict(nnetFit, nnet_test, type = "raw")

nnet_pred = as.factor(nnet_pred)

confusionMatrix(net_pred, nnet_test$RESPONSE, positive = "Good Rating")


```

```{r nnet plot}
plotnet(nnetFit, pos_col = "darkgreen", neg_col = "darkred")
```

